{%- comment -%} SOCIAL SHARE BUTTONS - Optimized Native share API support with
fallback to social links Includes copy link, print, and email options {%-
endcomment -%} {%- assign share_url = page.url | absolute_url -%} {%- assign
share_title = page.title | default: site.title -%} {%- assign share_text =
page.description | default: page.excerpt | default: site.description |
strip_html | truncatewords: 50 -%}

<div
  class="social-share animate-fade-in"
  role="region"
  aria-label="Share this content"
  style="
  padding: {{ include.padding | default: '1.5rem' }};
  background: {{ include.background | default: 'rgba(255, 255, 255, 0.03)' }};
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: var(--radius-md, 8px);
  margin: {{ include.margin | default: '2rem 0' }};
"
>
  <div
    style="
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
      flex-wrap: wrap;
    "
  >
    <div
      class="social-share__label"
      style="
        font-weight: 600;
        font-size: 0.95rem;
        color: var(--color-text-muted, rgba(255, 255, 255, 0.8));
        display: flex;
        align-items: center;
        gap: 0.5rem;
      "
    >
      <svg
        width="20"
        height="20"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
        aria-hidden="true"
      >
        <circle cx="18" cy="5" r="3"></circle>
        <circle cx="6" cy="12" r="3"></circle>
        <circle cx="18" cy="19" r="3"></circle>
        <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
        <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
      </svg>
      Share this:
    </div>

    <div
      class="social-share__buttons"
      style="display: flex; gap: 0.75rem; flex-wrap: wrap"
    >
      <!-- Native Share Button (Mobile) -->
      <button
        class="social-share-btn social-share-btn--native"
        onclick="nativeShare()"
        aria-label="Share using device share menu"
        style="
          display: none;
          align-items: center;
          justify-content: center;
          width: 44px;
          height: 44px;
          background: rgba(96, 165, 250, 0.2);
          color: #60a5fa;
          border: 1px solid rgba(96, 165, 250, 0.3);
          border-radius: var(--radius-md, 8px);
          cursor: pointer;
          transition: all 0.2s;
        "
      >
        <svg
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8" />
          <polyline points="16 6 12 2 8 6" />
          <line x1="12" y1="2" x2="12" y2="15" />
        </svg>
      </button>

      <!-- Twitter -->
      <a
        href="https://twitter.com/intent/tweet?url={{ share_url | url_encode }}&text={{ share_title | url_encode }}"
        target="_blank"
        rel="noopener noreferrer"
        aria-label="Share on Twitter"
        class="social-share-btn social-share-btn--twitter"
        data-platform="twitter"
        style="
          display: inline-flex;
          align-items: center;
          justify-content: center;
          width: 44px;
          height: 44px;
          background: #1da1f2;
          color: white;
          border-radius: var(--radius-md, 8px);
          transition: all 0.2s;
          text-decoration: none;
        "
      >
        <svg
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="currentColor"
          aria-hidden="true"
        >
          <path
            d="M23 3a10.9 10.9 0 01-3.14 1.53 4.48 4.48 0 00-7.86 3v1A10.66 10.66 0 013 4s-4 9 5 13a11.64 11.64 0 01-7 2c9 5 20 0 20-11.5a4.5 4.5 0 00-.08-.83A7.72 7.72 0 0023 3z"
          />
        </svg>
      </a>

      <!-- Facebook -->
      <a
        href="https://www.facebook.com/sharer/sharer.php?u={{ share_url | url_encode }}"
        target="_blank"
        rel="noopener noreferrer"
        aria-label="Share on Facebook"
        class="social-share-btn social-share-btn--facebook"
        data-platform="facebook"
        style="
          display: inline-flex;
          align-items: center;
          justify-content: center;
          width: 44px;
          height: 44px;
          background: #1877f2;
          color: white;
          border-radius: var(--radius-md, 8px);
          transition: all 0.2s;
          text-decoration: none;
        "
      >
        <svg
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="currentColor"
          aria-hidden="true"
        >
          <path
            d="M18 2h-3a5 5 0 00-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 011-1h3z"
          />
        </svg>
      </a>

      <!-- LinkedIn -->
      <a
        href="https://www.linkedin.com/shareArticle?mini=true&url={{ share_url | url_encode }}&title={{ share_title | url_encode }}&summary={{ share_text | url_encode }}"
        target="_blank"
        rel="noopener noreferrer"
        aria-label="Share on LinkedIn"
        class="social-share-btn social-share-btn--linkedin"
        data-platform="linkedin"
        style="
          display: inline-flex;
          align-items: center;
          justify-content: center;
          width: 44px;
          height: 44px;
          background: #0a66c2;
          color: white;
          border-radius: var(--radius-md, 8px);
          transition: all 0.2s;
          text-decoration: none;
        "
      >
        <svg
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="currentColor"
          aria-hidden="true"
        >
          <path
            d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6zM2 9h4v12H2z"
          />
          <circle cx="4" cy="4" r="2" />
        </svg>
      </a>

      <!-- Email -->
      <a
        href="mailto:?subject={{ share_title | url_encode }}&body={{ share_text | url_encode }}%0A%0A{{ share_url | url_encode }}"
        aria-label="Share via Email"
        class="social-share-btn social-share-btn--email"
        data-platform="email"
        style="
          display: inline-flex;
          align-items: center;
          justify-content: center;
          width: 44px;
          height: 44px;
          background: #ea4335;
          color: white;
          border-radius: var(--radius-md, 8px);
          transition: all 0.2s;
          text-decoration: none;
        "
      >
        <svg
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          aria-hidden="true"
        >
          <path
            d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"
          />
          <polyline points="22,6 12,13 2,6" />
        </svg>
      </a>

      <!-- Print -->
      <button
        onclick="window.print()"
        aria-label="Print this page"
        class="social-share-btn social-share-btn--print"
        style="
          display: inline-flex;
          align-items: center;
          justify-content: center;
          width: 44px;
          height: 44px;
          background: rgba(148, 163, 184, 0.2);
          color: #94a3b8;
          border: 1px solid rgba(148, 163, 184, 0.3);
          border-radius: var(--radius-md, 8px);
          transition: all 0.2s;
          cursor: pointer;
        "
      >
        <svg
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          aria-hidden="true"
        >
          <polyline points="6 9 6 2 18 2 18 9" />
          <path
            d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"
          />
          <rect x="6" y="14" width="12" height="8" />
        </svg>
      </button>

      <!-- Copy Link -->
      <button
        class="social-share-btn social-share-btn--copy"
        onclick="copyShareLink(this)"
        aria-label="Copy link to clipboard"
        data-url="{{ share_url }}"
        style="
          display: inline-flex;
          align-items: center;
          justify-content: center;
          width: 44px;
          height: 44px;
          background: rgba(255, 255, 255, 0.1);
          color: white;
          border: 1px solid rgba(255, 255, 255, 0.2);
          border-radius: var(--radius-md, 8px);
          transition: all 0.2s;
          cursor: pointer;
        "
      >
        <svg
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          aria-hidden="true"
        >
          <path
            d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"
          />
          <path
            d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"
          />
        </svg>
      </button>
    </div>
  </div>

  <!-- Share count (optional) -->
  <div
    id="share-count"
    class="share-count"
    style="
      margin-top: 1rem;
      padding-top: 1rem;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      font-size: 0.85rem;
      color: rgba(255, 255, 255, 0.6);
      display: none;
    "
  ></div>
</div>

<script>
  // Native share API
  function nativeShare() {
    if (navigator.share) {
      navigator
        .share({
          title: "{{ share_title | escape }}",
          text: "{{ share_text | escape }}",
          url: "{{ share_url }}",
        })
        .then(() => {
          trackShare("native");
        })
        .catch((err) => {
          if (err.name !== "AbortError") {
            console.error("Share failed:", err);
          }
        });
    }
  }

  // Show native share button on supported devices
  if (navigator.share) {
    const nativeBtn = document.querySelector(".social-share-btn--native");
    if (nativeBtn) {
      nativeBtn.style.display = "inline-flex";
    }
  }

  // Copy link function
  function copyShareLink(btn) {
    const url = btn.dataset.url || "{{ share_url }}";

    if (navigator.clipboard && navigator.clipboard.writeText) {
      navigator.clipboard
        .writeText(url)
        .then(() => {
          showCopyFeedback(btn, true);
          trackShare("copy");
        })
        .catch((err) => {
          console.error("Copy failed:", err);
          fallbackCopy(url, btn);
        });
    } else {
      fallbackCopy(url, btn);
    }
  }

  // Fallback copy method
  function fallbackCopy(text, btn) {
    const textarea = document.createElement("textarea");
    textarea.value = text;
    textarea.style.position = "fixed";
    textarea.style.opacity = "0";
    document.body.appendChild(textarea);
    textarea.select();

    try {
      document.execCommand("copy");
      showCopyFeedback(btn, true);
      trackShare("copy");
    } catch (err) {
      showCopyFeedback(btn, false);
    }

    document.body.removeChild(textarea);
  }

  // Visual feedback for copy
  function showCopyFeedback(btn, success) {
    const originalHTML = btn.innerHTML;
    const originalBg = btn.style.background;

    if (success) {
      btn.innerHTML =
        '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>';
      btn.style.background = "var(--color-success, #10b981)";
      btn.setAttribute("aria-label", "Link copied!");
    } else {
      btn.innerHTML =
        '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>';
      btn.style.background = "var(--color-error, #ef4444)";
      btn.setAttribute("aria-label", "Copy failed");
    }

    setTimeout(() => {
      btn.innerHTML = originalHTML;
      btn.style.background = originalBg;
      btn.setAttribute("aria-label", "Copy link to clipboard");
    }, 2000);
  }

  // Track shares
  function trackShare(platform) {
    if (typeof gtag === "function") {
      gtag("event", "share", {
        event_category: "Social Share",
        event_label: platform,
        page_path: "{{ page.url }}",
      });
    }

    // Update local share count
    const shareCount =
      localStorage.getItem("share_count_{{ page.url | slugify }}") || 0;
    localStorage.setItem(
      "share_count_{{ page.url | slugify }}",
      parseInt(shareCount) + 1,
    );
  }

  // Track social link clicks
  document
    .querySelectorAll(".social-share-btn[data-platform]")
    .forEach((btn) => {
      btn.addEventListener("click", function () {
        trackShare(this.dataset.platform);
      });
    });

  // Hover effects
  document.querySelectorAll(".social-share-btn").forEach((btn) => {
    btn.addEventListener("mouseenter", function () {
      this.style.transform = "translateY(-3px)";
      const bg = window.getComputedStyle(this).backgroundColor;
      this.style.boxShadow = `0 6px 16px ${bg.replace("rgb", "rgba").replace(")", ", 0.4)")}`;
    });

    btn.addEventListener("mouseleave", function () {
      this.style.transform = "translateY(0)";
      this.style.boxShadow = "none";
    });
  });
</script>

<style>
  @media (prefers-reduced-motion: reduce) {
    .social-share-btn {
      transition: none !important;
    }
  }
</style>
