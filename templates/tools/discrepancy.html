<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Discrepancy Finder | BarberX Legal Tech</title>
    <link rel="stylesheet" href="/assets/css/legal-tech-platform.css">
    <style>
        body {
            background: var(--bg-color);
            margin: 0;
            padding: 2rem;
        }

        .tool-container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .tool-header {
            background: var(--surface-color);
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            border-left: 4px solid #ef4444;
        }

        .discrepancy-card {
            background: var(--surface-color);
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            border-left: 4px solid #ef4444;
        }

        .discrepancy-card.major {
            border-left-color: #f59e0b;
        }

        .discrepancy-card.minor {
            border-left-color: #10b981;
        }

        .severity-badge {
            display: inline-block;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .severity-badge.critical {
            background: #fee2e2;
            color: #991b1b;
        }

        .severity-badge.major {
            background: #fef3c7;
            color: #92400e;
        }

        .severity-badge.minor {
            background: #d1fae5;
            color: #065f46;
        }

        .evidence-comparison {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 1rem;
            margin: 1.5rem 0;
            padding: 1.5rem;
            background: var(--bg-color);
            border-radius: 8px;
        }

        .evidence-item {
            padding: 1rem;
            border-radius: 8px;
        }

        .evidence-item.bwc {
            background: #dbeafe;
            border-left: 4px solid #3b82f6;
        }

        .evidence-item.report {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
        }

        .vs-divider {
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: var(--text-secondary);
        }

        .legal-note {
            background: #eff6ff;
            border-left: 4px solid #3b82f6;
            padding: 1rem;
            margin-top: 1rem;
            border-radius: 4px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--surface-color);
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .stat-value.critical {
            color: #ef4444;
        }

        .stat-value.major {
            color: #f59e0b;
        }

        .stat-value.minor {
            color: #10b981;
        }

        .analysis-selector {
            background: var(--surface-color);
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
        }

        .empty-state {
            background: var(--surface-color);
            padding: 4rem 2rem;
            border-radius: 12px;
            text-align: center;
            color: var(--text-secondary);
        }
    </style>
</head>
<body>
    <div class="tool-container">
        <div class="tool-header">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <h1 style="margin: 0 0 0.5rem 0;">‚ö†Ô∏è Discrepancy Finder</h1>
                    <p style="margin: 0; color: var(--text-secondary);">Identify contradictions between BWC footage and official reports</p>
                </div>
                <a href="/dashboard" class="btn btn-secondary">‚Üê Back to Dashboard</a>
            </div>
        </div>

        <div class="analysis-selector">
            <h3 style="margin-bottom: 1rem;">Select Analysis</h3>
            <div style="display: flex; gap: 1rem; align-items: end;">
                <div style="flex: 1;">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Choose BWC Analysis</label>
                    <select id="analysisSelect" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 8px;">
                        <option value="">-- Select an analysis --</option>
                        <option value="atl-002794">ATL-L-002794-25 (Jan 15, 2025)</option>
                        <option value="usdj-15641">USDJ 1:25-cv-15641 (Feb 3, 2025)</option>
                    </select>
                </div>
                <button class="btn btn-primary" onclick="loadDiscrepancies()" style="min-width: 180px;">Find Discrepancies</button>
            </div>
        </div>

        <div id="discrepanciesContainer">
            <div class="empty-state">
                <div style="font-size: 4rem; margin-bottom: 1rem;">‚ö†Ô∏è</div>
                <h3 style="margin-bottom: 0.5rem;">No Analysis Selected</h3>
                <p>Select an analysis above to find discrepancies</p>
            </div>
        </div>
    </div>

    <script>
        const sampleDiscrepancies = {
            'atl-002794': [
                {
                    type: 'statement',
                    severity: 'critical',
                    bwcEvidence: 'Civilian (John Doe) states: "I did not resist. I was cooperating the entire time."',
                    bwcTimestamp: '14:40:00',
                    conflictingEvidence: 'Police report states: "Subject actively resisted arrest and had to be restrained."',
                    conflictingSource: 'Police Report',
                    legalSignificance: 'Potential Brady material - contradicts officer\'s account of resistance. May support excessive force claim.',
                    recommendation: 'Request complete BWC footage and use this segment to impeach officer testimony.'
                },
                {
                    type: 'timing',
                    severity: 'major',
                    bwcEvidence: 'BWC shows officer arrived on scene at 14:35:00',
                    bwcTimestamp: '14:35:00',
                    conflictingEvidence: 'CAD log shows arrival time as 14:42:00',
                    conflictingSource: 'CAD Log',
                    legalSignificance: '7-minute discrepancy could affect timeline of events and witness credibility.',
                    recommendation: 'Cross-reference with dispatch audio logs and GPS data.'
                },
                {
                    type: 'identification',
                    severity: 'critical',
                    bwcEvidence: 'BWC shows second civilian (Jane Smith) present at scene, identified by name at 14:38:00',
                    bwcTimestamp: '14:38:00',
                    conflictingEvidence: 'Police report makes no mention of Jane Smith or any other civilian witnesses',
                    conflictingSource: 'Police Report',
                    legalSignificance: 'Potential Brady violation - exculpatory witness not disclosed. May have favorable testimony.',
                    recommendation: 'Subpoena Jane Smith for deposition. File Brady motion.'
                },
                {
                    type: 'event',
                    severity: 'major',
                    bwcEvidence: 'BWC shows officer searched vehicle without asking for consent at 14:45:00',
                    bwcTimestamp: '14:45:00',
                    conflictingEvidence: 'Police report states: "Consensual search of vehicle conducted"',
                    conflictingSource: 'Police Report',
                    legalSignificance: 'Fourth Amendment violation - search may be illegal if no consent obtained.',
                    recommendation: 'File motion to suppress evidence from vehicle search.'
                }
            ],
            'usdj-15641': [
                {
                    type: 'statement',
                    severity: 'critical',
                    bwcEvidence: 'Officer states: "I saw him reaching for something in his waistband"',
                    bwcTimestamp: '22:15:00',
                    conflictingEvidence: 'BWC video shows subject\'s hands were visible and empty at all times',
                    conflictingSource: 'BWC Video Analysis',
                    legalSignificance: 'Officer\'s stated justification for force contradicted by video evidence.',
                    recommendation: 'Use video evidence to impeach officer testimony regarding threat perception.'
                },
                {
                    type: 'timing',
                    severity: 'minor',
                    bwcEvidence: 'BWC timestamp shows incident began at 22:10:00',
                    bwcTimestamp: '22:10:00',
                    conflictingEvidence: 'Police report lists incident start time as 22:05:00',
                    conflictingSource: 'Police Report',
                    legalSignificance: 'Minor timing discrepancy, but pattern of inaccuracies undermines report credibility.',
                    recommendation: 'Note as part of broader pattern of reporting inaccuracies.'
                }
            ]
        };

        function loadDiscrepancies() {
            const selectedAnalysis = document.getElementById('analysisSelect').value;
            
            if (!selectedAnalysis) {
                alert('Please select an analysis');
                return;
            }

            const discrepancies = sampleDiscrepancies[selectedAnalysis];
            
            if (!discrepancies) {
                document.getElementById('discrepanciesContainer').innerHTML = `
                    <div class="empty-state">
                        <div style="font-size: 4rem; margin-bottom: 1rem;">‚úÖ</div>
                        <h3 style="margin-bottom: 0.5rem;">No Discrepancies Found</h3>
                        <p>This analysis shows no contradictions between BWC and official reports</p>
                    </div>
                `;
                return;
            }

            displayDiscrepancies(discrepancies);
        }

        function displayDiscrepancies(discrepancies) {
            const critical = discrepancies.filter(d => d.severity === 'critical').length;
            const major = discrepancies.filter(d => d.severity === 'major').length;
            const minor = discrepancies.filter(d => d.severity === 'minor').length;

            const html = `
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value critical">${critical}</div>
                        <div style="color: var(--text-secondary);">Critical Discrepancies</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value major">${major}</div>
                        <div style="color: var(--text-secondary);">Major Discrepancies</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value minor">${minor}</div>
                        <div style="color: var(--text-secondary);">Minor Discrepancies</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" style="color: var(--accent-blue);">${discrepancies.length}</div>
                        <div style="color: var(--text-secondary);">Total Found</div>
                    </div>
                </div>

                ${discrepancies.map((disc, index) => `
                    <div class="discrepancy-card ${disc.severity}">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                            <div>
                                <h3 style="margin: 0 0 0.5rem 0;">${getTypeLabel(disc.type)} Discrepancy #${index + 1}</h3>
                                <span class="severity-badge ${disc.severity}">${disc.severity}</span>
                            </div>
                            <span style="color: var(--text-secondary); font-size: 0.875rem;">üïê ${disc.bwcTimestamp}</span>
                        </div>

                        <div class="evidence-comparison">
                            <div class="evidence-item bwc">
                                <div style="font-weight: 700; margin-bottom: 0.5rem; color: #1e40af;">üìπ BWC Evidence</div>
                                <p style="margin: 0;">${disc.bwcEvidence}</p>
                            </div>
                            <div class="vs-divider">VS</div>
                            <div class="evidence-item report">
                                <div style="font-weight: 700; margin-bottom: 0.5rem; color: #92400e;">üìÑ ${disc.conflictingSource}</div>
                                <p style="margin: 0;">${disc.conflictingEvidence}</p>
                            </div>
                        </div>

                        <div class="legal-note">
                            <div style="font-weight: 700; margin-bottom: 0.5rem;">‚öñÔ∏è Legal Significance</div>
                            <p style="margin: 0 0 0.75rem 0;">${disc.legalSignificance}</p>
                            <div style="font-weight: 700; margin-bottom: 0.5rem;">üí° Recommendation</div>
                            <p style="margin: 0;">${disc.recommendation}</p>
                        </div>
                    </div>
                `).join('')}

                <div style="background: var(--surface-color); padding: 2rem; border-radius: 12px; margin-top: 2rem;">
                    <h3 style="margin-bottom: 1rem;">Export Discrepancy Report</h3>
                    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                        <button class="btn btn-primary" onclick="exportDiscrepancies('pdf')">
                            üìÑ Export as PDF
                        </button>
                        <button class="btn btn-secondary" onclick="exportDiscrepancies('docx')">
                            üìù Export as DOCX
                        </button>
                        <button class="btn btn-secondary" onclick="exportDiscrepancies('json')">
                            üíæ Export as JSON
                        </button>
                        <button class="btn btn-secondary" onclick="emailDiscrepancies()">
                            ‚úâÔ∏è Email to Attorney
                        </button>
                    </div>
                </div>
            `;

            document.getElementById('discrepanciesContainer').innerHTML = html;
        }

        function getTypeLabel(type) {
            const labels = {
                'statement': 'üí¨ Statement',
                'timing': '‚è∞ Timing',
                'identification': 'üë§ Identification',
                'event': 'üìç Event'
            };
            return labels[type] || type;
        }

        function exportDiscrepancies(format) {
            alert(`Exporting discrepancies as ${format.toUpperCase()}...\n\nIn production, this would download a file.`);
        }

        function emailDiscrepancies() {
            alert('Email discrepancy report?\n\nIn production, this would open email dialog with report attached.');
        }
    </script>
</body>
</html>
