<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Batch PDF Upload | BarberX Legal Tech</title>
    <link rel="stylesheet" href="/assets/css/legal-tech-platform.css" />
    <style>
      .upload-container {
        max-width: 1200px;
        margin: 2rem auto;
        padding: 0 2rem;
      }

      .page-header {
        text-align: center;
        margin-bottom: 3rem;
      }

      .page-header h1 {
        font-size: 2.5rem;
        color: var(--text-primary);
        margin-bottom: 1rem;
      }

      .page-header p {
        color: var(--text-secondary);
        font-size: 1.125rem;
      }

      .upload-zone {
        background: var(--surface-color);
        border: 3px dashed var(--border-color);
        border-radius: 12px;
        padding: 4rem 2rem;
        text-align: center;
        transition: all 0.3s ease;
        cursor: pointer;
        position: relative;
      }

      .upload-zone:hover,
      .upload-zone.dragover {
        border-color: var(--accent-blue);
        background: var(--primary-navy-10);
        transform: translateY(-2px);
      }

      .upload-zone.dragging {
        border-color: var(--accent-cyan);
        background: var(--primary-navy-20);
      }

      .upload-icon {
        font-size: 5rem;
        margin-bottom: 1rem;
        opacity: 0.5;
      }

      .upload-zone h2 {
        font-size: 1.75rem;
        margin-bottom: 0.5rem;
        color: var(--text-primary);
      }

      .upload-zone p {
        color: var(--text-secondary);
        margin-bottom: 1.5rem;
      }

      .file-input {
        display: none;
      }

      .btn-upload {
        display: inline-block;
        padding: 0.875rem 2rem;
        background: var(--accent-blue);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.2s;
      }

      .btn-upload:hover {
        background: #0056b3;
      }

      .upload-info {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1.5rem;
        margin-top: 2rem;
        padding: 1.5rem;
        background: var(--bg-color);
        border-radius: 8px;
      }

      .info-item {
        text-align: center;
      }

      .info-label {
        font-size: 0.875rem;
        color: var(--text-secondary);
        text-transform: uppercase;
        letter-spacing: 0.05em;
        margin-bottom: 0.5rem;
      }

      .info-value {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--accent-blue);
      }

      .files-list {
        margin-top: 2rem;
        display: none;
      }

      .files-list.active {
        display: block;
      }

      .files-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
      }

      .files-header h3 {
        font-size: 1.5rem;
        color: var(--text-primary);
      }

      .btn-clear {
        padding: 0.5rem 1.5rem;
        background: #ef4444;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
        transition: background 0.2s;
      }

      .btn-clear:hover {
        background: #dc2626;
      }

      .file-item {
        background: var(--surface-color);
        padding: 1rem 1.5rem;
        border-radius: 8px;
        margin-bottom: 0.75rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: all 0.2s;
      }

      .file-item:hover {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      }

      .file-item.uploading {
        opacity: 0.6;
      }

      .file-item.success {
        border-left: 4px solid #10b981;
      }

      .file-item.error {
        border-left: 4px solid #ef4444;
      }

      .file-info {
        flex: 1;
      }

      .file-name {
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 0.25rem;
      }

      .file-size {
        font-size: 0.875rem;
        color: var(--text-secondary);
      }

      .file-status {
        display: flex;
        align-items: center;
        gap: 1rem;
      }

      .status-badge {
        padding: 0.25rem 0.75rem;
        border-radius: 12px;
        font-size: 0.875rem;
        font-weight: 600;
      }

      .status-badge.pending {
        background: #fef3c7;
        color: #92400e;
      }

      .status-badge.uploading {
        background: #dbeafe;
        color: #1e40af;
      }

      .status-badge.success {
        background: #d1fae5;
        color: #065f46;
      }

      .status-badge.error {
        background: #fee2e2;
        color: #991b1b;
      }

      .btn-remove {
        padding: 0.5rem 1rem;
        background: transparent;
        color: #6b7280;
        border: 1px solid #d1d5db;
        border-radius: 6px;
        cursor: pointer;
        font-size: 0.875rem;
        transition: all 0.2s;
      }

      .btn-remove:hover {
        background: #fee2e2;
        color: #991b1b;
        border-color: #fecaca;
      }

      .progress-bar {
        width: 100%;
        height: 4px;
        background: var(--border-color);
        border-radius: 2px;
        overflow: hidden;
        margin-top: 0.5rem;
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(
          90deg,
          var(--accent-blue),
          var(--accent-cyan)
        );
        width: 0%;
        transition: width 0.3s ease;
      }

      .batch-actions {
        margin-top: 2rem;
        padding: 1.5rem;
        background: var(--surface-color);
        border-radius: 8px;
        display: none;
      }

      .batch-actions.active {
        display: block;
      }

      .actions-grid {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
      }

      .btn-action {
        padding: 0.875rem 2rem;
        border: none;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
      }

      .btn-primary {
        background: var(--accent-blue);
        color: white;
      }

      .btn-primary:hover {
        background: #0056b3;
        transform: translateY(-1px);
      }

      .btn-primary:disabled {
        background: #9ca3af;
        cursor: not-allowed;
        transform: none;
      }

      .btn-secondary {
        background: transparent;
        color: var(--accent-blue);
        border: 2px solid var(--accent-blue);
      }

      .btn-secondary:hover {
        background: var(--primary-navy-10);
      }

      .upload-results {
        margin-top: 2rem;
        padding: 1.5rem;
        background: var(--surface-color);
        border-radius: 8px;
        display: none;
      }

      .upload-results.active {
        display: block;
      }

      .results-summary {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 1rem;
        margin-bottom: 1.5rem;
      }

      .summary-card {
        padding: 1rem;
        background: var(--bg-color);
        border-radius: 6px;
        text-align: center;
      }

      .summary-number {
        font-size: 2rem;
        font-weight: 700;
        margin-bottom: 0.25rem;
      }

      .summary-number.success {
        color: #10b981;
      }

      .summary-number.error {
        color: #ef4444;
      }

      .summary-number.total {
        color: var(--accent-blue);
      }

      .summary-label {
        font-size: 0.875rem;
        color: var(--text-secondary);
      }

      @media (max-width: 768px) {
        .upload-container {
          padding: 0 1rem;
        }

        .page-header h1 {
          font-size: 2rem;
        }

        .upload-zone {
          padding: 2rem 1rem;
        }

        .upload-icon {
          font-size: 3rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="upload-container">
      <div class="page-header">
        <h1>üìÑ Batch PDF Upload</h1>
        <p>Upload multiple PDF files for processing and analysis</p>
      </div>

      <!-- Upload Zone -->
      <div class="upload-zone" id="uploadZone">
        <div class="upload-icon">üìÅ</div>
        <h2>Drag & Drop PDF Files</h2>
        <p>or click to browse your computer</p>
        <button
          class="btn-upload"
          onclick="document.getElementById('fileInput').click()"
        >
          Select Files
        </button>
        <input
          type="file"
          id="fileInput"
          class="file-input"
          multiple
          accept=".pdf,application/pdf"
        />
      </div>

      <!-- Upload Info -->
      <div class="upload-info">
        <div class="info-item">
          <div class="info-label">Max File Size</div>
          <div class="info-value">50 MB</div>
        </div>
        <div class="info-item">
          <div class="info-label">Accepted Format</div>
          <div class="info-value">PDF</div>
        </div>
        <div class="info-item">
          <div class="info-label">Max Files</div>
          <div class="info-value">100</div>
        </div>
        <div class="info-item">
          <div class="info-label">Files Selected</div>
          <div class="info-value" id="fileCount">0</div>
        </div>
      </div>

      <!-- Files List -->
      <div class="files-list" id="filesList">
        <div class="files-header">
          <h3>Selected Files</h3>
          <button class="btn-clear" onclick="clearAllFiles()">Clear All</button>
        </div>
        <div id="filesContainer"></div>
      </div>

      <!-- Batch Actions -->
      <div class="batch-actions" id="batchActions">
        <div class="actions-grid">
          <button
            class="btn-action btn-primary"
            id="uploadBtn"
            onclick="startBatchUpload()"
          >
            Upload All Files
          </button>
          <button class="btn-action btn-secondary" onclick="addMoreFiles()">
            Add More Files
          </button>
        </div>
      </div>

      <!-- Upload Results -->
      <div class="upload-results" id="uploadResults">
        <h3>Upload Results</h3>
        <div class="results-summary">
          <div class="summary-card">
            <div class="summary-number total" id="totalFiles">0</div>
            <div class="summary-label">Total Files</div>
          </div>
          <div class="summary-card">
            <div class="summary-number success" id="successFiles">0</div>
            <div class="summary-label">Successful</div>
          </div>
          <div class="summary-card">
            <div class="summary-number error" id="errorFiles">0</div>
            <div class="summary-label">Failed</div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Configuration
      const MAX_FILE_SIZE = 50 * 1024 * 1024; // 50MB
      const MAX_FILES = 100;
      const ALLOWED_TYPES = ["application/pdf"];

      // State
      let selectedFiles = [];
      let uploadInProgress = false;

      // DOM Elements
      const uploadZone = document.getElementById("uploadZone");
      const fileInput = document.getElementById("fileInput");
      const filesList = document.getElementById("filesList");
      const filesContainer = document.getElementById("filesContainer");
      const fileCount = document.getElementById("fileCount");
      const batchActions = document.getElementById("batchActions");
      const uploadResults = document.getElementById("uploadResults");
      const uploadBtn = document.getElementById("uploadBtn");

      // Initialize
      function init() {
        setupEventListeners();
      }

      function setupEventListeners() {
        // File input change
        fileInput.addEventListener("change", handleFileSelect);

        // Drag and drop
        uploadZone.addEventListener("click", () => {
          if (!uploadInProgress) {
            fileInput.click();
          }
        });

        uploadZone.addEventListener("dragover", (e) => {
          e.preventDefault();
          uploadZone.classList.add("dragover");
        });

        uploadZone.addEventListener("dragleave", () => {
          uploadZone.classList.remove("dragover");
        });

        uploadZone.addEventListener("drop", (e) => {
          e.preventDefault();
          uploadZone.classList.remove("dragover");

          if (!uploadInProgress) {
            const files = Array.from(e.dataTransfer.files);
            addFiles(files);
          }
        });
      }

      function handleFileSelect(e) {
        const files = Array.from(e.target.files);
        addFiles(files);
      }

      function addFiles(files) {
        const validFiles = files.filter((file) => {
          // Check file type
          if (
            !ALLOWED_TYPES.includes(file.type) &&
            !file.name.toLowerCase().endsWith(".pdf")
          ) {
            showNotification(`${file.name} is not a PDF file`, "error");
            return false;
          }

          // Check file size
          if (file.size > MAX_FILE_SIZE) {
            showNotification(
              `${file.name} exceeds maximum file size (50MB)`,
              "error",
            );
            return false;
          }

          // Check if already added
          if (
            selectedFiles.some(
              (f) => f.name === file.name && f.size === file.size,
            )
          ) {
            showNotification(`${file.name} is already in the list`, "warning");
            return false;
          }

          return true;
        });

        // Check max files limit
        if (selectedFiles.length + validFiles.length > MAX_FILES) {
          showNotification(`Maximum ${MAX_FILES} files allowed`, "error");
          return;
        }

        // Add files to state
        validFiles.forEach((file) => {
          selectedFiles.push({
            id: Date.now() + Math.random(),
            file: file,
            name: file.name,
            size: file.size,
            status: "pending",
            progress: 0,
            error: null,
          });
        });

        updateUI();
      }

      function updateUI() {
        // Update file count
        fileCount.textContent = selectedFiles.length;

        // Show/hide lists
        if (selectedFiles.length > 0) {
          filesList.classList.add("active");
          batchActions.classList.add("active");
        } else {
          filesList.classList.remove("active");
          batchActions.classList.remove("active");
        }

        // Render files list
        renderFilesList();

        // Update button state
        uploadBtn.disabled = uploadInProgress || selectedFiles.length === 0;
      }

      function renderFilesList() {
        filesContainer.innerHTML = selectedFiles
          .map(
            (fileData, index) => `
                <div class="file-item ${fileData.status}" id="file-${fileData.id}">
                    <div class="file-info">
                        <div class="file-name">${escapeHtml(fileData.name)}</div>
                        <div class="file-size">${formatFileSize(fileData.size)}</div>
                        ${
                          fileData.progress > 0
                            ? `
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${fileData.progress}%"></div>
                            </div>
                        `
                            : ""
                        }
                        ${
                          fileData.error
                            ? `
                            <div style="color: #ef4444; font-size: 0.875rem; margin-top: 0.5rem;">
                                ${escapeHtml(fileData.error)}
                            </div>
                        `
                            : ""
                        }
                    </div>
                    <div class="file-status">
                        <span class="status-badge ${fileData.status}">
                            ${getStatusText(fileData.status)}
                        </span>
                        ${
                          fileData.status === "pending"
                            ? `
                            <button class="btn-remove" onclick="removeFile(${index})">Remove</button>
                        `
                            : ""
                        }
                    </div>
                </div>
            `,
          )
          .join("");
      }

      function removeFile(index) {
        if (!uploadInProgress) {
          selectedFiles.splice(index, 1);
          updateUI();
        }
      }

      function clearAllFiles() {
        if (!uploadInProgress && confirm("Clear all files?")) {
          selectedFiles = [];
          fileInput.value = "";
          updateUI();
          uploadResults.classList.remove("active");
        }
      }

      function addMoreFiles() {
        if (!uploadInProgress) {
          fileInput.click();
        }
      }

      async function startBatchUpload() {
        if (uploadInProgress || selectedFiles.length === 0) return;

        uploadInProgress = true;
        uploadBtn.disabled = true;
        uploadBtn.textContent = "Uploading...";

        let successCount = 0;
        let errorCount = 0;

        for (let i = 0; i < selectedFiles.length; i++) {
          const fileData = selectedFiles[i];

          if (fileData.status !== "pending") continue;

          fileData.status = "uploading";
          updateUI();

          try {
            const result = await uploadFile(fileData);

            if (result.success) {
              fileData.status = "success";
              fileData.progress = 100;
              successCount++;
            } else {
              fileData.status = "error";
              fileData.error = result.error || "Upload failed";
              errorCount++;
            }
          } catch (error) {
            fileData.status = "error";
            fileData.error = error.message || "Upload failed";
            errorCount++;
          }

          updateUI();
        }

        uploadInProgress = false;
        uploadBtn.disabled = false;
        uploadBtn.textContent = "Upload All Files";

        // Show results
        showResults(selectedFiles.length, successCount, errorCount);
      }

      async function uploadFile(fileData) {
        const formData = new FormData();
        formData.append("file", fileData.file);
        formData.append("filename", fileData.name);

        try {
          const response = await fetch("/api/upload/pdf", {
            method: "POST",
            body: formData,
            // Track progress
          });

          if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.error || "Upload failed");
          }

          const data = await response.json();
          return { success: true, data };
        } catch (error) {
          return { success: false, error: error.message };
        }
      }

      function showResults(total, success, errors) {
        document.getElementById("totalFiles").textContent = total;
        document.getElementById("successFiles").textContent = success;
        document.getElementById("errorFiles").textContent = errors;
        uploadResults.classList.add("active");
      }

      function getStatusText(status) {
        const statusMap = {
          pending: "Pending",
          uploading: "Uploading...",
          success: "Success",
          error: "Failed",
        };
        return statusMap[status] || status;
      }

      function formatFileSize(bytes) {
        if (bytes === 0) return "0 Bytes";
        const k = 1024;
        const sizes = ["Bytes", "KB", "MB", "GB"];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return (
          Math.round((bytes / Math.pow(k, i)) * 100) / 100 + " " + sizes[i]
        );
      }

      function escapeHtml(text) {
        const div = document.createElement("div");
        div.textContent = text;
        return div.innerHTML;
      }

      function showNotification(message, type = "info") {
        // Simple console notification for now
        console.log(`[${type.toUpperCase()}] ${message}`);
        // You can implement a proper toast notification here
      }

      // Initialize on load
      init();
    </script>
  </body>
</html>
