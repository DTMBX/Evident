{%- comment -%}
ADVANCED SEO & SOCIAL META TAGS - Optimized
Comprehensive Open Graph, Twitter Cards, JSON-LD, and mobile optimization
{%- endcomment -%}

{%- assign page_title = page.title | default: site.title -%}
{%- assign page_description = page.description | default: page.excerpt | default: site.description | strip_html | truncatewords: 30 -%}
{%- assign page_image = page.image | default: page.og_image | default: site.og_image | default: '/assets/images/og-default.jpg' -%}
{%- unless page_image contains '://' -%}{%- assign page_image = page_image | absolute_url -%}{%- endunless -%}
{%- assign page_url = page.url | absolute_url -%}
{%- assign site_name = site.title | default: site.name -%}

<!-- Primary Meta Tags -->
<meta name="title" content="{{ page_title }}">
<meta name="description" content="{{ page_description }}">
{% if page.keywords or site.keywords %}<meta name="keywords" content="{{ page.keywords | default: site.keywords | join: ', ' }}">{% endif %}
{% if page.author or site.author %}<meta name="author" content="{{ page.author | default: site.author }}">{% endif %}
<meta name="robots" content="{{ page.robots | default: site.robots | default: 'index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1' }}">
<link rel="canonical" href="{{ page_url }}">

<!-- Language & Geographic -->
<meta name="language" content="{{ page.lang | default: site.lang | default: 'en' }}">
{% if site.geo_region %}<meta name="geo.region" content="{{ site.geo_region }}">{% endif %}
{% if site.geo_placename %}<meta name="geo.placename" content="{{ site.geo_placename }}">{% endif %}

<!-- Open Graph / Facebook -->
<meta property="og:type" content="{{ page.og_type | default: 'website' }}">
<meta property="og:url" content="{{ page_url }}">
<meta property="og:title" content="{{ page_title }}">
<meta property="og:description" content="{{ page_description }}">
<meta property="og:image" content="{{ page_image }}">
<meta property="og:image:alt" content="{{ page.image_alt | default: page_title }}">
<meta property="og:site_name" content="{{ site_name }}">
<meta property="og:locale" content="{{ page.lang | default: site.lang | default: 'en_US' | replace: '-', '_' }}">
{% if page.date %}<meta property="article:published_time" content="{{ page.date | date_to_xmlschema }}">{% endif %}
{% if page.last_updated or page.modified_date %}<meta property="article:modified_time" content="{{ page.last_updated | default: page.modified_date | date_to_xmlschema }}">{% endif %}
{% if page.author %}<meta property="article:author" content="{{ page.author }}">{% endif %}
{% if page.tags %}{% for tag in page.tags %}<meta property="article:tag" content="{{ tag }}">{% endfor %}{% endif %}
{% if page.collection == 'cases' or page.layout == 'case' %}<meta property="article:section" content="Legal">{% endif %}

<!-- Twitter Card -->
<meta name="twitter:card" content="{{ page.twitter_card | default: site.twitter_card | default: 'summary_large_image' }}">
<meta name="twitter:url" content="{{ page_url }}">
<meta name="twitter:title" content="{{ page_title | truncate: 70 }}">
<meta name="twitter:description" content="{{ page_description | truncate: 200 }}">
<meta name="twitter:image" content="{{ page_image }}">
<meta name="twitter:image:alt" content="{{ page.image_alt | default: page_title }}">
{% if site.twitter_username %}<meta name="twitter:site" content="@{{ site.twitter_username }}">{% endif %}
{% if page.author_twitter %}<meta name="twitter:creator" content="@{{ page.author_twitter }}">{% endif %}
{% if site.twitter_username %}<meta name="twitter:domain" content="{{ site.url | remove: 'https://' | remove: 'http://' }}">{% endif %}

<!-- Schema.org JSON-LD (Enhanced) -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "{{ page.schema_type | default: 'WebPage' }}",
      "@id": "{{ page_url }}#webpage",
      "url": "{{ page_url }}",
      "name": "{{ page_title }}",
      "description": "{{ page_description }}",
      "inLanguage": "{{ page.lang | default: site.lang | default: 'en-US' }}",
      {% if page_image != '' %}"image": {
        "@type": "ImageObject",
        "url": "{{ page_image }}",
        "width": "{{ page.image_width | default: 1200 }}",
        "height": "{{ page.image_height | default: 630 }}"
      },{% endif %}
      {% if page.date %}"datePublished": "{{ page.date | date_to_xmlschema }}",{% endif %}
      {% if page.last_updated or page.modified_date %}"dateModified": "{{ page.last_updated | default: page.modified_date | date_to_xmlschema }}",{% endif %}
      "isPartOf": { "@id": "{{ site.url }}/#website" }{% if page.author %},
      "author": {
        "@type": "Person",
        "name": "{{ page.author }}"{% if page.author_url %},
        "url": "{{ page.author_url }}"{% endif %}
      }{% endif %}{% if page.publisher or site.organization %},
      "publisher": {
        "@type": "Organization",
        "name": "{{ page.publisher | default: site.organization | default: site_name }}",
        "logo": {
          "@type": "ImageObject",
          "url": "{{ site.logo | default: '/assets/images/logo.png' | absolute_url }}"
        }
      }{% endif %}
    },
    {
      "@type": "WebSite",
      "@id": "{{ site.url }}/#website",
      "url": "{{ site.url }}",
      "name": "{{ site_name }}",
      "description": "{{ site.description }}",
      "inLanguage": "{{ site.lang | default: 'en-US' }}"{% if site.enable_search %},
      "potentialAction": {
        "@type": "SearchAction",
        "target": "{{ site.url }}/search/?q={search_term_string}",
        "query-input": "required name=search_term_string"
      }{% endif %}
    }{% if site.organization %},
    {
      "@type": "Organization",
      "@id": "{{ site.url }}/#organization",
      "name": "{{ site.organization }}",
      "url": "{{ site.url }}"{% if site.logo %},
      "logo": "{{ site.logo | absolute_url }}"{% endif %}{% if site.contact_email %},
      "contactPoint": {
        "@type": "ContactPoint",
        "email": "{{ site.contact_email }}",
        "contactType": "Customer Service"
      }{% endif %}{% if site.social_links %},
      "sameAs": [{% for link in site.social_links %}"{{ link }}"{% unless forloop.last %},{% endunless %}{% endfor %}]{% endif %}
    }{% endif %}{% if page.breadcrumbs %},
    {
      "@type": "BreadcrumbList",
      "@id": "{{ page_url }}#breadcrumb",
      "itemListElement": [{% for crumb in page.breadcrumbs %}{
        "@type": "ListItem",
        "position": {{ forloop.index }},
        "name": "{{ crumb.title }}",
        "item": "{{ crumb.url | absolute_url }}"
      }{% unless forloop.last %},{% endunless %}{% endfor %}]
    }{% endif %}
  ]
}
</script>

<!-- Mobile & PWA Optimization -->
<meta name="theme-color" content="{{ page.theme_color | default: site.theme_color | default: '#dc2626' }}">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="{{ site.short_name | default: site_name }}">
<meta name="mobile-web-app-capable" content="yes">
<meta name="application-name" content="{{ site.short_name | default: site_name }}">

<!-- Additional Meta -->
<meta name="referrer" content="{{ site.referrer_policy | default: 'strict-origin-when-cross-origin' }}">
{% if page.noindex or page.robots contains 'noindex' %}<meta name="googlebot" content="noindex">{% endif %}
{% if site.google_site_verification %}<meta name="google-site-verification" content="{{ site.google_site_verification }}">{% endif %}
{% if site.msvalidate %}<meta name="msvalidate.01" content="{{ site.msvalidate }}">{% endif %}
{% if site.fb_app_id %}<meta property="fb:app_id" content="{{ site.fb_app_id }}">{% endif %}

<!-- Preconnect for Performance -->
<link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
{% if site.analytics_provider == 'google' or site.analytics_provider == 'ga4' %}<link rel="preconnect" href="https://www.googletagmanager.com" crossorigin>{% endif %}
{% if site.analytics_provider == 'plausible' %}<link rel="preconnect" href="https://plausible.io" crossorigin>{% endif %}
