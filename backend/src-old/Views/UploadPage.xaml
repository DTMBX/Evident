<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodel="clr-namespace:Evident.MatterDocket.MAUI.ViewModels"
             x:Class="Evident.MatterDocket.MAUI.Views.UploadPage"
             x:DataType="viewmodel:UploadViewModel"
             Title="Upload Evidence"
             BackgroundColor="#0f0f0f">

    <ScrollView>
        <VerticalStackLayout Padding="30" Spacing="25">
            
            <!-- Header -->
            <VerticalStackLayout Spacing="10">
                <Label Text="Upload Evidence"
                       FontSize="28"
                       FontAttributes="Bold"
                       TextColor="#d4a574"/>
                <Label Text="Upload PDFs or videos for AI analysis"
                       FontSize="16"
                       TextColor="#b0b0b0"/>
            </VerticalStackLayout>

            <!-- File Type Selector -->
            <VerticalStackLayout Spacing="10" Margin="0,20,0,0">
                <Label Text="Evidence Type"
                       FontSize="16"
                       TextColor="#ffffff"/>
                <Grid ColumnDefinitions="*,*" ColumnSpacing="10">
                    <Border Stroke="{Binding FileType, Converter={StaticResource FileTypeToPdfBorderConverter}}"
                            StrokeThickness="2"
                            BackgroundColor="#1a1a1a"
                            Padding="15">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="8"/>
                        </Border.StrokeShape>
                        <Border.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding SelectPdfTypeCommand}"/>
                        </Border.GestureRecognizers>
                        <Label Text="ðŸ“„ PDF"
                               FontSize="18"
                               TextColor="{Binding FileType, Converter={StaticResource FileTypeToPdfColorConverter}}"
                               HorizontalTextAlignment="Center"/>
                    </Border>
                    <Border Grid.Column="1"
                            Stroke="{Binding FileType, Converter={StaticResource FileTypeToVideoBorderConverter}}"
                            StrokeThickness="2"
                            BackgroundColor="#1a1a1a"
                            Padding="15">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="8"/>
                        </Border.StrokeShape>
                        <Border.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding SelectVideoTypeCommand}"/>
                        </Border.GestureRecognizers>
                        <Label Text="ðŸŽ¥ Video"
                               FontSize="18"
                               TextColor="{Binding FileType, Converter={StaticResource FileTypeToVideoColorConverter}}"
                               HorizontalTextAlignment="Center"/>
                    </Border>
                </Grid>
            </VerticalStackLayout>

            <!-- File Selection -->
            <Border Stroke="#d4a574"
                    StrokeThickness="1"
                    BackgroundColor="#1a1a1a"
                    Padding="20"
                    Margin="0,10,0,0">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="8"/>
                </Border.StrokeShape>
                <VerticalStackLayout Spacing="15">
                    <Label Text="Selected File"
                           FontSize="16"
                           FontAttributes="Bold"
                           TextColor="#ffffff"/>
                    
                    <Label Text="{Binding SelectedFileName, FallbackValue='No file selected'}"
                           FontSize="14"
                           TextColor="#b0b0b0"
                           LineBreakMode="TailTruncation"/>
                    
                    <Label Text="{Binding FormattedFileSize}"
                           IsVisible="{Binding SelectedFileName, Converter={StaticResource StringNotNullOrEmptyConverter}}"
                           FontSize="13"
                           TextColor="#d4a574"/>

                    <Button Text="ðŸ“ Choose File"
                            Command="{Binding SelectFileCommand}"
                            BackgroundColor="#d4a574"
                            TextColor="#0f0f0f"
                            FontSize="16"
                            FontAttributes="Bold"
                            HeightRequest="50"
                            CornerRadius="8"
                            Margin="0,10,0,0"/>
                </VerticalStackLayout>
            </Border>

            <!-- Upload Progress -->
            <Border Stroke="#d4a574"
                    StrokeThickness="1"
                    BackgroundColor="#1a1a1a"
                    Padding="20"
                    IsVisible="{Binding IsUploading}">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="8"/>
                </Border.StrokeShape>
                <VerticalStackLayout Spacing="10">
                    <Label Text="Uploading..."
                           FontSize="16"
                           FontAttributes="Bold"
                           TextColor="#ffffff"/>
                    <ProgressBar Progress="{Binding UploadProgress}"
                                 ProgressColor="#d4a574"
                                 HeightRequest="8"/>
                    <Label Text="{Binding UploadProgress, StringFormat='{0:P0}', Converter={StaticResource PercentageConverter}}"
                           FontSize="14"
                           TextColor="#b0b0b0"
                           HorizontalTextAlignment="Center"/>
                </VerticalStackLayout>
            </Border>

            <!-- Analysis Options -->
            <Border Stroke="#d4a574"
                    StrokeThickness="1"
                    BackgroundColor="#1a1a1a"
                    Padding="20"
                    IsVisible="{Binding SelectedFileName, Converter={StaticResource StringNotNullOrEmptyConverter}}">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="8"/>
                </Border.StrokeShape>
                <VerticalStackLayout Spacing="15">
                    <Label Text="Analysis Options"
                           FontSize="16"
                           FontAttributes="Bold"
                           TextColor="#ffffff"/>

                    <HorizontalStackLayout Spacing="10">
                        <CheckBox IsChecked="{Binding RunAnalysisAfterUpload}"
                                  Color="#d4a574"/>
                        <Label Text="Run AI analysis after upload"
                               TextColor="#b0b0b0"
                               VerticalOptions="Center"/>
                    </HorizontalStackLayout>

                    <VerticalStackLayout Spacing="8" IsVisible="{Binding RunAnalysisAfterUpload}">
                        <Label Text="Analysis Type"
                               FontSize="14"
                               TextColor="#ffffff"/>
                        <Picker ItemsSource="{Binding AnalysisTypes}"
                                SelectedItem="{Binding AnalysisType}"
                                TextColor="#ffffff"
                                BackgroundColor="#0f0f0f"
                                FontSize="14"/>
                    </VerticalStackLayout>
                </VerticalStackLayout>
            </Border>

            <!-- Error Message -->
            <Label Text="{Binding ErrorMessage}"
                   IsVisible="{Binding ErrorMessage, Converter={StaticResource StringNotNullOrEmptyConverter}}"
                   TextColor="#ff4444"
                   FontSize="14"
                   HorizontalTextAlignment="Center"
                   Padding="10"/>

            <!-- Upload Button -->
            <Button Text="ðŸ“¤ Upload File"
                    Command="{Binding UploadFileCommand}"
                    IsEnabled="{Binding IsBusy, Converter={StaticResource InverseBoolConverter}}"
                    IsVisible="{Binding UploadComplete, Converter={StaticResource InverseBoolConverter}}"
                    BackgroundColor="#d4a574"
                    TextColor="#0f0f0f"
                    FontSize="18"
                    FontAttributes="Bold"
                    HeightRequest="55"
                    CornerRadius="8"
                    Margin="0,10,0,0">
                <Button.Shadow>
                    <Shadow Brush="#d4a574" Opacity="0.5" Radius="10" Offset="0,4"/>
                </Button.Shadow>
            </Button>

            <!-- Success Message -->
            <Border Stroke="#10B981"
                    StrokeThickness="2"
                    BackgroundColor="#1a1a1a"
                    Padding="20"
                    IsVisible="{Binding UploadComplete}">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="8"/>
                </Border.StrokeShape>
                <VerticalStackLayout Spacing="15">
                    <Label Text="âœ… Upload Complete!"
                           FontSize="20"
                           FontAttributes="Bold"
                           TextColor="#10B981"
                           HorizontalTextAlignment="Center"/>
                    
                    <Label Text="Your file has been uploaded successfully."
                           FontSize="14"
                           TextColor="#b0b0b0"
                           HorizontalTextAlignment="Center"/>

                    <Button Text="Upload Another File"
                            Command="{Binding ResetUploadCommand}"
                            BackgroundColor="Transparent"
                            BorderColor="#d4a574"
                            BorderWidth="1"
                            TextColor="#d4a574"
                            CornerRadius="8"
                            Margin="0,10,0,0"/>
                </VerticalStackLayout>
            </Border>

            <!-- Loading Indicator -->
            <ActivityIndicator IsRunning="{Binding IsBusy}"
                             IsVisible="{Binding IsBusy}"
                             Color="#d4a574"
                             HeightRequest="40"
                             Margin="0,20"/>

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>

