{%- comment -%} OPRA LIST COMPONENT Displays OPRA records filtered by status.
Usage: {% include opra-list.html status="Active" %} Pass status="ALL" to show
all records. {%- endcomment -%} {% assign filter_status = include.status |
default: "ALL" %} {% if filter_status == "ALL" %} {% assign opra_records =
site.opra | where_exp: "item", "item.id != 'template'" | sort: "last_updated" |
reverse %} {% else %} {% assign opra_records = site.opra | where: "status",
filter_status | where_exp: "item", "item.id != 'template'" | sort:
"last_updated" | reverse %} {% endif %} {% if opra_records.size > 0 %}
<div class="opra-records-grid">
  {% for record in opra_records %} {% assign search_text = record.title |
  append: " " | append: record.authority_primary | append: " " | append:
  record.status | append: " " | append: record.topics | join: " " | downcase %}
  <article
    class="opra-record-card opra-record--{{ record.status | downcase | replace: ' ', '-' }} premium-card haptic-tap"
    data-status="{{ record.status | downcase | replace: ' ', '-' }}"
    data-searchable="{{ search_text | strip_html | truncate: 300 }}"
  >
    <header class="opra-record__header">
      <span
        class="opra-record__status opra-record__status--{{ record.status | downcase | replace: ' ', '-' }}"
      >
        {{ record.status | default: "Unknown" }}
      </span>
      <span class="opra-record__authority"
        >{{ record.authority_primary | truncate: 30, "" }}</span
      >
    </header>

    <div class="opra-record__body">
      <h3 class="opra-record__title">
        <a href="{{ record.url | relative_url }}"
          >{{ record.title | truncate: 80 }}</a
        >
      </h3>

      {% if record.topics and record.topics.size > 0 %}
      <div class="opra-record__topics">
        {% for topic in record.topics limit:2 %}
        <span class="opra-record__topic">{{ topic | truncate: 25 }}</span>
        {% endfor %} {% if record.topics.size > 2 %}
        <span class="opra-record__topic opra-record__topic--more"
          >+{{ record.topics.size | minus: 2 }}</span
        >
        {% endif %}
      </div>
      {% endif %}
    </div>

    <footer class="opra-record__footer">
      <div class="opra-record__meta">
        {% if record.opened %}
        <span class="opra-record__date"
          >Opened: {{ record.opened | date: "%b %Y" }}</span
        >
        {% endif %} {% if record.last_updated %}
        <span class="opra-record__date"
          >Updated: {{ record.last_updated | date: "%b %d, %Y" }}</span
        >
        {% endif %}
      </div>

      <div class="opra-record__links">
        {% if record.url %}
        <a href="{{ record.url | relative_url }}" class="opra-record__link"
          >View Record →</a
        >
        {% endif %} {% if record.opramachine_body_url and
        record.opramachine_body_url != "" %}
        <a
          href="{{ record.opramachine_body_url }}"
          class="opra-record__link opra-record__link--external"
          target="_blank"
          rel="noopener"
        >
          OPRAMachine ↗
        </a>
        {% endif %}
      </div>
    </footer>
  </article>
  {% endfor %}
</div>
{% else %}
<div class="opra-no-records">
  <p>No OPRA records found with status: <strong>{{ filter_status }}</strong></p>
</div>
{% endif %}
