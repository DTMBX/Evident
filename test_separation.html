<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Frontend/Backend Separation Test | BarberX</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        background: #f9fafb;
        padding: 2rem;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
      }

      h1 {
        color: #1e40af;
        margin-bottom: 2rem;
        text-align: center;
      }

      .test-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
        gap: 2rem;
        margin-bottom: 2rem;
      }

      .test-section {
        background: white;
        border-radius: 12px;
        padding: 2rem;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .test-section h2 {
        color: #1e40af;
        margin-bottom: 1rem;
        font-size: 1.25rem;
        border-bottom: 2px solid #e5e7eb;
        padding-bottom: 0.5rem;
      }

      .test-item {
        padding: 0.75rem;
        margin: 0.5rem 0;
        border-left: 3px solid #cbd5e1;
        background: #f9fafb;
        border-radius: 4px;
      }

      .test-item.success {
        border-left-color: #10b981;
        background: #f0fdf4;
      }

      .test-item.error {
        border-left-color: #ef4444;
        background: #fef2f2;
      }

      .test-item.warning {
        border-left-color: #f59e0b;
        background: #fffbeb;
      }

      .test-item.loading {
        border-left-color: #3b82f6;
        background: #eff6ff;
      }

      .test-name {
        font-weight: 600;
        color: #1f2937;
        margin-bottom: 0.25rem;
      }

      .test-result {
        font-size: 0.875rem;
        color: #6b7280;
      }

      .status-badge {
        display: inline-block;
        padding: 0.25rem 0.75rem;
        border-radius: 12px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        margin-left: 0.5rem;
      }

      .status-badge.pass {
        background: #10b981;
        color: white;
      }

      .status-badge.fail {
        background: #ef4444;
        color: white;
      }

      .status-badge.pending {
        background: #f59e0b;
        color: white;
      }

      button {
        background: #1e40af;
        color: white;
        border: none;
        padding: 0.75rem 1.5rem;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        font-size: 1rem;
        margin: 0.5rem;
      }

      button:hover {
        background: #1e3a8a;
      }

      button:disabled {
        background: #9ca3af;
        cursor: not-allowed;
      }

      .summary {
        background: #1e40af;
        color: white;
        padding: 2rem;
        border-radius: 12px;
        text-align: center;
      }

      .summary h2 {
        margin-bottom: 1rem;
      }

      .summary-stats {
        display: flex;
        justify-content: center;
        gap: 3rem;
        font-size: 1.5rem;
        font-weight: 700;
      }

      .summary-stat {
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .summary-stat span:first-child {
        font-size: 3rem;
        margin-bottom: 0.5rem;
      }

      pre {
        background: #1f2937;
        color: #f9fafb;
        padding: 1rem;
        border-radius: 8px;
        overflow-x: auto;
        font-size: 0.875rem;
        margin: 0.5rem 0;
      }

      code {
        font-family: "Courier New", monospace;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ðŸ§ª Frontend/Backend Separation Test Suite</h1>

      <div style="text-align: center; margin-bottom: 2rem">
        <button onclick="runAllTests()">Run All Tests</button>
        <button onclick="location.reload()">Reset</button>
      </div>

      <div class="test-grid">
        <!-- Frontend Tests -->
        <div class="test-section">
          <h2>ðŸ“± Frontend Tests</h2>
          <div id="frontend-tests"></div>
        </div>

        <!-- Backend API Tests -->
        <div class="test-section">
          <h2>ðŸ”Œ Backend API Tests</h2>
          <div id="backend-tests"></div>
        </div>

        <!-- Separation of Concerns -->
        <div class="test-section">
          <h2>ðŸ”€ Separation Tests</h2>
          <div id="separation-tests"></div>
        </div>

        <!-- Export Functions -->
        <div class="test-section">
          <h2>ðŸ“„ Export Functions</h2>
          <div id="export-tests"></div>
        </div>
      </div>

      <div class="summary" id="summary">
        <h2>Test Summary</h2>
        <div class="summary-stats">
          <div class="summary-stat">
            <span id="pass-count">0</span>
            <span>Passed</span>
          </div>
          <div class="summary-stat">
            <span id="fail-count">0</span>
            <span>Failed</span>
          </div>
          <div class="summary-stat">
            <span id="total-count">0</span>
            <span>Total</span>
          </div>
        </div>
      </div>
    </div>

    <script>
      let testResults = {
        passed: 0,
        failed: 0,
        total: 0,
      };

      function addTest(containerId, name, status, result) {
        const container = document.getElementById(containerId);
        const testItem = document.createElement("div");
        testItem.className = `test-item ${status}`;

        const statusBadge =
          status === "success"
            ? "pass"
            : status === "error"
              ? "fail"
              : "pending";

        testItem.innerHTML = `
                <div class="test-name">
                    ${name}
                    <span class="status-badge ${statusBadge}">${statusBadge}</span>
                </div>
                <div class="test-result">${result}</div>
            `;

        container.appendChild(testItem);

        testResults.total++;
        if (status === "success") testResults.passed++;
        if (status === "error") testResults.failed++;

        updateSummary();
      }

      function updateSummary() {
        document.getElementById("pass-count").textContent = testResults.passed;
        document.getElementById("fail-count").textContent = testResults.failed;
        document.getElementById("total-count").textContent = testResults.total;
      }

      async function runAllTests() {
        testResults = { passed: 0, failed: 0, total: 0 };
        document.getElementById("frontend-tests").innerHTML = "";
        document.getElementById("backend-tests").innerHTML = "";
        document.getElementById("separation-tests").innerHTML = "";
        document.getElementById("export-tests").innerHTML = "";

        await testFrontend();
        await testBackend();
        await testSeparation();
        await testExports();
      }

      async function testFrontend() {
        // Test 1: Dashboard HTML loads
        try {
          const response = await fetch("/bwc-dashboard");
          if (response.ok) {
            addTest(
              "frontend-tests",
              "Dashboard HTML Route",
              "success",
              `âœ… /bwc-dashboard accessible (${response.status})`,
            );
          } else {
            addTest(
              "frontend-tests",
              "Dashboard HTML Route",
              "error",
              `âŒ Status: ${response.status}`,
            );
          }
        } catch (error) {
          addTest(
            "frontend-tests",
            "Dashboard HTML Route",
            "error",
            `âŒ ${error.message}`,
          );
        }

        // Test 2: CSS loads
        try {
          const response = await fetch("/assets/css/legal-tech-platform.css");
          if (response.ok) {
            addTest(
              "frontend-tests",
              "CSS Stylesheet",
              "success",
              `âœ… Stylesheet loads successfully`,
            );
          } else {
            addTest(
              "frontend-tests",
              "CSS Stylesheet",
              "warning",
              `âš ï¸ CSS not found (${response.status})`,
            );
          }
        } catch (error) {
          addTest(
            "frontend-tests",
            "CSS Stylesheet",
            "warning",
            `âš ï¸ ${error.message}`,
          );
        }

        // Test 3: JavaScript functionality
        const hasLocalStorage = typeof localStorage !== "undefined";
        if (hasLocalStorage) {
          addTest(
            "frontend-tests",
            "Browser Storage",
            "success",
            `âœ… LocalStorage available`,
          );
        } else {
          addTest(
            "frontend-tests",
            "Browser Storage",
            "error",
            `âŒ LocalStorage not available`,
          );
        }

        // Test 4: Fetch API
        const hasFetch = typeof fetch !== "undefined";
        if (hasFetch) {
          addTest(
            "frontend-tests",
            "Fetch API",
            "success",
            `âœ… Fetch API available`,
          );
        } else {
          addTest(
            "frontend-tests",
            "Fetch API",
            "error",
            `âŒ Fetch API not available`,
          );
        }

        // Test 5: ES6+ Features
        try {
          const arrow = () => true;
          const { test } = { test: true };
          if (arrow() && test) {
            addTest(
              "frontend-tests",
              "ES6+ Support",
              "success",
              `âœ… Arrow functions, destructuring work`,
            );
          }
        } catch (error) {
          addTest(
            "frontend-tests",
            "ES6+ Support",
            "error",
            `âŒ ES6+ not supported`,
          );
        }
      }

      async function testBackend() {
        // Test 1: API endpoint structure
        try {
          const response = await fetch("/api/analyses");
          if (response.status === 401 || response.status === 403) {
            addTest(
              "backend-tests",
              "API Authentication",
              "success",
              `âœ… Auth required (${response.status})`,
            );
          } else if (response.ok) {
            addTest(
              "backend-tests",
              "API Authentication",
              "warning",
              `âš ï¸ No auth required (check security)`,
            );
          } else {
            addTest(
              "backend-tests",
              "API Authentication",
              "error",
              `âŒ Unexpected status: ${response.status}`,
            );
          }
        } catch (error) {
          addTest(
            "backend-tests",
            "API Authentication",
            "error",
            `âŒ ${error.message}`,
          );
        }

        // Test 2: JSON response format
        try {
          const response = await fetch("/api/analyses");
          const contentType = response.headers.get("content-type");
          if (contentType && contentType.includes("application/json")) {
            addTest(
              "backend-tests",
              "JSON Response Format",
              "success",
              `âœ… Returns JSON (${contentType})`,
            );
          } else {
            addTest(
              "backend-tests",
              "JSON Response Format",
              "error",
              `âŒ Not JSON: ${contentType}`,
            );
          }
        } catch (error) {
          addTest(
            "backend-tests",
            "JSON Response Format",
            "error",
            `âŒ ${error.message}`,
          );
        }

        // Test 3: CORS headers
        try {
          const response = await fetch("/api/analyses");
          const corsHeader = response.headers.get(
            "Access-Control-Allow-Origin",
          );
          if (corsHeader || response.status === 401) {
            addTest(
              "backend-tests",
              "CORS Configuration",
              "success",
              `âœ… CORS handled properly`,
            );
          } else {
            addTest(
              "backend-tests",
              "CORS Configuration",
              "warning",
              `âš ï¸ No CORS headers found`,
            );
          }
        } catch (error) {
          addTest(
            "backend-tests",
            "CORS Configuration",
            "warning",
            `âš ï¸ ${error.message}`,
          );
        }

        // Test 4: Database connection
        try {
          const response = await fetch("/");
          if (response.ok) {
            addTest(
              "backend-tests",
              "Database Connection",
              "success",
              `âœ… Server running with DB`,
            );
          } else {
            addTest(
              "backend-tests",
              "Database Connection",
              "error",
              `âŒ Server error`,
            );
          }
        } catch (error) {
          addTest(
            "backend-tests",
            "Database Connection",
            "error",
            `âŒ ${error.message}`,
          );
        }
      }

      async function testSeparation() {
        // Test 1: No inline business logic in HTML
        try {
          const response = await fetch("/bwc-dashboard");
          const html = await response.text();

          const hasInlineSQL =
            html.toLowerCase().includes("select ") ||
            html.toLowerCase().includes("insert into");
          const hasInlinePython =
            html.includes("import ") && html.includes("def ");

          if (!hasInlineSQL && !hasInlinePython) {
            addTest(
              "separation-tests",
              "No Backend Logic in Frontend",
              "success",
              `âœ… Clean separation maintained`,
            );
          } else {
            addTest(
              "separation-tests",
              "No Backend Logic in Frontend",
              "error",
              `âŒ Backend code found in HTML`,
            );
          }
        } catch (error) {
          addTest(
            "separation-tests",
            "No Backend Logic in Frontend",
            "warning",
            `âš ï¸ Could not verify`,
          );
        }

        // Test 2: API-only data access
        try {
          const response = await fetch("/bwc-dashboard");
          const html = await response.text();

          const usesAPI =
            html.includes("fetch(") || html.includes("XMLHttpRequest");

          if (usesAPI) {
            addTest(
              "separation-tests",
              "API-Based Data Access",
              "success",
              `âœ… Uses fetch API for data`,
            );
          } else {
            addTest(
              "separation-tests",
              "API-Based Data Access",
              "warning",
              `âš ï¸ API calls not detected`,
            );
          }
        } catch (error) {
          addTest(
            "separation-tests",
            "API-Based Data Access",
            "warning",
            `âš ï¸ Could not verify`,
          );
        }

        // Test 3: RESTful endpoint structure
        const endpoints = [
          "/api/analyses",
          "/api/analysis/test-id",
          "/api/analysis/test-id/status",
          "/api/analysis/test-id/report/pdf",
        ];

        let restful = true;
        for (const endpoint of endpoints) {
          const hasProperStructure =
            endpoint.startsWith("/api/") && endpoint.split("/").length >= 3;
          if (!hasProperStructure) {
            restful = false;
            break;
          }
        }

        if (restful) {
          addTest(
            "separation-tests",
            "RESTful API Design",
            "success",
            `âœ… Follows REST conventions`,
          );
        } else {
          addTest(
            "separation-tests",
            "RESTful API Design",
            "error",
            `âŒ Non-RESTful endpoints found`,
          );
        }

        // Test 4: Static vs Dynamic content
        const staticRoutes = ["/", "/bwc-dashboard"];
        const apiRoutes = ["/api/analyses", "/api/analysis/1"];

        addTest(
          "separation-tests",
          "Static/Dynamic Separation",
          "success",
          `âœ… ${staticRoutes.length} static, ${apiRoutes.length} API routes`,
        );
      }

      async function testExports() {
        // Test 1: Export formats available
        const formats = ["pdf", "docx", "json", "txt", "md"];
        addTest(
          "export-tests",
          "Export Format Support",
          "success",
          `âœ… ${formats.length} formats: ${formats.join(", ")}`,
        );

        // Test 2: Export endpoint structure
        for (const format of formats) {
          const endpoint = `/api/analysis/test-id/report/${format}`;
          const isValid =
            endpoint.includes("/report/") && endpoint.endsWith(format);

          if (isValid) {
            addTest(
              "export-tests",
              `${format.toUpperCase()} Endpoint`,
              "success",
              `âœ… ${endpoint}`,
            );
          } else {
            addTest(
              "export-tests",
              `${format.toUpperCase()} Endpoint`,
              "error",
              `âŒ Invalid structure`,
            );
          }
        }

        // Test 3: Dependencies check
        try {
          const response = await fetch("/bwc-dashboard");
          const html = await response.text();

          if (html.includes("exportReport")) {
            addTest(
              "export-tests",
              "Export Function Available",
              "success",
              `âœ… exportReport() function present`,
            );
          } else {
            addTest(
              "export-tests",
              "Export Function Available",
              "warning",
              `âš ï¸ Function not found in HTML`,
            );
          }
        } catch (error) {
          addTest(
            "export-tests",
            "Export Function Available",
            "error",
            `âŒ ${error.message}`,
          );
        }
      }

      // Auto-run tests on load
      window.addEventListener("load", () => {
        setTimeout(runAllTests, 500);
      });
    </script>
  </body>
</html>
