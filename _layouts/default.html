<!doctype html>
<html lang="{{ page.lang | default: site.lang | default: 'en' }}"{% if page.dir %} dir="{{ page.dir }}"{% endif %}>
  <head>
    {%- comment -%} Brand Tokens - Load First {%- endcomment -%}
    <link rel="stylesheet" href="{{ '/assets/css/brand-tokens.css' | relative_url }}" />
    <link rel="stylesheet" href="{{ '/assets/css/components/barber-branding.css' | relative_url }}" />
    
    {%- comment -%} UX Enhancements {%- endcomment -%}
    <link rel="stylesheet" href="{{ '/assets/css/components/ux-enhancements.css' | relative_url }}" />
    
    {%- comment -%} Enhanced Animation System {%- endcomment -%}
    <link rel="stylesheet" href="{{ '/assets/css/enhanced-animations.css' | relative_url }}" />
    
    {%- comment -%} SEO & Social Meta Tags {%- endcomment -%}
    {% include components/seo-meta.html %}
    
    {% include layout/head/head.html %}
    
    {%- comment -%} Page-specific stylesheet from front matter {%- endcomment -%}
    {% if page.stylesheet %}
    <link rel="stylesheet" href="{{ page.stylesheet | relative_url }}" />
    {% endif %}
    
    {%- comment -%} Case cards component - load when using case-cards {%- endcomment -%}
    {% if page.permalink == '/cases/' or page.collection == 'cases' or page.layout == 'case' or page.layout == 'case-enhanced' %}
    <link rel="stylesheet" href="{{ '/assets/css/components/case-cards.css' | relative_url }}" />
    {% endif %}
    
    {%- comment -%} Page-specific CSS based on layout type {%- endcomment -%}
    {% if page.layout == 'case' or page.layout == 'case-enhanced' %}
    <link rel="stylesheet" href="{{ '/assets/css/pages/cases.css' | relative_url }}" />
    <link rel="stylesheet" href="{{ '/assets/css/pages/case-enhanced.css' | relative_url }}" />
    <link rel="stylesheet" href="{{ '/assets/css/pages/case-analysis.css' | relative_url }}" />
    {% elsif page.layout == 'essay' %}
    <link rel="stylesheet" href="{{ '/assets/css/pages/essays.css' | relative_url }}" />
    {% elsif page.layout == 'article' %}
    <link rel="stylesheet" href="{{ '/assets/css/pages/articles.css' | relative_url }}" />
    {% endif %}
    
    {%- comment -%} Collection-based CSS {%- endcomment -%}
    {% if page.collection == 'cases' %}
    <link rel="stylesheet" href="{{ '/assets/css/pages/cases.css' | relative_url }}" />
    <link rel="stylesheet" href="{{ '/assets/css/pages/case-enhanced.css' | relative_url }}" />
    {% elsif page.collection == 'essays' %}
    <link rel="stylesheet" href="{{ '/assets/css/pages/essays.css' | relative_url }}" />
    {% elsif page.collection == 'opra' %}
    <link rel="stylesheet" href="{{ '/assets/css/pages/opra.css' | relative_url }}" />
    {% endif %}
    
    {%- comment -%} Body class-based CSS {%- endcomment -%}
    {% if page.body_class contains 'case' %}
    <link rel="stylesheet" href="{{ '/assets/css/pages/cases.css' | relative_url }}" />
    {% endif %}
    
    {%- comment -%} Custom CSS per page {%- endcomment -%}
    {% unless page.hide_barber_pole %}
    <link rel="stylesheet" href="{{ '/assets/css/components/barber-pole-spinner.css' | relative_url }}" />
    {% endunless %}
    
    {% if page.extra_css %}
      {% for css in page.extra_css %}
    <link rel="stylesheet" href="{{ css | relative_url }}" />
      {% endfor %}
    {% endif %}
    
    {%- comment -%} Page-specific head content {%- endcomment -%}
    {% if page.custom_head %}{{ page.custom_head }}{% endif %}
  </head>

  <body{% if page.body_class %} class="{{ page.body_class }}"{% endif %}{% if page.data_theme %} data-theme="{{ page.data_theme }}"{% endif %} data-layout="{{ page.layout | default: 'default' }}"{% if page.collection %} data-collection="{{ page.collection }}"{% endif %}>
    
    {%- comment -%} Reading Progress Bar {%- endcomment -%}
    {% unless page.hide_progress_bar %}
    {% include components/reading-progress.html %}
    {% endunless %}
    
    {%- comment -%} Skip to main content link for accessibility {%- endcomment -%}
    <a href="#main-content" class="skip-to-content">Skip to main content</a>

    {%- comment -%} Cookie Consent Banner {%- endcomment -%}
    {% include components/cookie-consent.html %}

    {%- comment -%} Maintenance banner - sitewide {%- endcomment -%}
    {% if site.maintenance_mode or page.maintenance_banner %}
    {% include components/banners/maintenance-banner.html %}
    {% endif %}

    {%- comment -%} Header navigation {%- endcomment -%}
    {% unless page.hide_header %}
      {% include components/navigation/header.html %}
    {% endunless %}

    {%- comment -%} Main content area with layout-specific classes {%- endcomment -%}
    <main id="main" tabindex="-1"{% if page.main_class %} class="{{ page.main_class }}"{% elsif page.layout == 'case' or page.layout == 'case-enhanced' %} class="case-main"{% elsif page.layout == 'page' %} class="page-main"{% elsif page.layout == 'essay' %} class="essay-main"{% endif %}{% if page.main_role %} role="{{ page.main_role }}"{% endif %}>
      {{ content }}
    </main>

    {%- comment -%} Footer {%- endcomment -%}
    {% unless page.hide_footer %}
      {% include layout/footer/footer.html %}
    {% endunless %}

    {%- comment -%} Back to Top Button {%- endcomment -%}
    {% unless page.hide_back_to_top %}
    {% include components/back-to-top.html %}
    {% endunless %}

    {%- comment -%} Barber pole spinner - decorative 1920s element (hidden on homepage which has its own in hero) {%- endcomment -%}
    {% unless page.hide_barber_pole or page.url == '/' %}
      {% include components/barber-pole-spinner.html position=page.barber_pole_position size=page.barber_pole_size show_on=page.barber_pole_show_on %}
    {% endunless %}

    {%- comment -%} JavaScript includes {%- endcomment -%}
    {% if page.extra_js %}
      {% for js in page.extra_js %}
    <script src="{{ js | relative_url }}" defer></script>
      {% endfor %}
    {% endif %}
    
    {%- comment -%} Layout-specific JavaScript {%- endcomment -%}
    {% if page.layout == 'case' or page.layout == 'case-enhanced' %}
    <script src="{{ '/assets/js/case-nav.js' | relative_url }}" defer></script>
    <script src="{{ '/assets/js/docket-navigator.js' | relative_url }}" defer></script>
    {% endif %}
    
    {%- comment -%} UX Enhancements JavaScript {%- endcomment -%}
    <script src="{{ '/assets/js/ux-enhancements.js' | relative_url }}" defer></script>
    
    {%- comment -%} Enhanced Animation & Theme System {%- endcomment -%}
    <script src="{{ '/assets/js/enhanced-animations.js' | relative_url }}" defer></script>
    <script src="{{ '/assets/js/theme-toggle-upgraded.js' | relative_url }}" defer></script>
    
    {%- comment -%} Main site JavaScript {%- endcomment -%}
    {% unless page.no_main_js %}
    <script src="{{ '/assets/js/main-upgraded.js' | relative_url }}" defer></script>
    {% endunless %}
    
    {%- comment -%} Page-specific inline scripts {%- endcomment -%}
    {% if page.custom_js %}
    <script>
      {{ page.custom_js }}
    </script>
    {% endif %}

    {%- comment -%} Analytics & Performance Tracking {%- endcomment -%}
    {% include components/analytics.html %}

  </body>
</html>
